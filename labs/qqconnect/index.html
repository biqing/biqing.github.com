<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta property="qc:admins" content="1312764241167671405261774123711376653471645060454" />
    <style type="text/css">
    #mask {
        display: none;
        position: absolute;
        height: 100%;
        width: 100%;
        top: 0;
        left: 0;
        background-color: #000;
        opacity: 0.5;
        filter: alpha(opacity=50);
    }
    #login_iframe {
        position: absolute;
        left: 35%;
        top: 20%;
        border: none;
        z-index: 10;
    }
    </style>
</head>
<body>
    <h1>Hello, everyone!</h1>
    <p>欢迎围观</p>
    <p>access_token: <span id="access_token"></span></p>
    <a href="javascript:showPopup();">打开QQ登录浮层</a><br/>

    <div id="mask"></div>
    <script type="text/javascript">
        var getCookie = function(name) {
            var r = new RegExp('(?:^|;+|\\s+)' + name + '=([^;]*)'),
                m = document.cookie.match(r);
            return (!m ? '' : m[1]);
        };

        var setCookie = function(name, value, domain, path, hour){
            if (hour) {
                var expire = new Date();
                expire.setTime(expire.getTime() + 3600000 * hour);
            }
            document.cookie = name + "=" + value + "; " + (hour ? ("expires=" + expire.toGMTString() + "; ") : "") + (path ? ("path=" + path + "; ") : "path=/; ") + (domain ? ("domain=" + domain + ";") : ("domain=" + Q.cookiedomainPrefix + ";"));
            return true;
        };

        var showPopup = function(){
            var iframe = document.createElement("iframe");
            iframe.id = "login_iframe";
            iframe.width = "433px";
            iframe.height = "387px";
            iframe.src = "http://openapi.qzone.qq.com/oauth/show?which=Login&display=pc&auth_time=&page_type=&client_id=100352117&redirect_uri=http%3A%2F%2Fbiqing.github.io%2Flabs%2Fqqconnect%2Fqc_back.html&scope=all&response_type=token&show_auth_items=0"
            document.body.appendChild(iframe);
            document.getElementById("mask").style.display = "block";
        };

        var onSuccess = function(hash){
            var iframe = document.getElementById("login_iframe");
            iframe.parentNode.removeChild( iframe );;
            document.getElementById("mask").style.display = "none";

            var hash = hash.slice(1).split("&"),
                ac = '';
            for(var i = hash.length; i--; ){
                if(hash[i].indexOf("access_token") != -1){
                    hash = hash[i].split("=");
                    ac = hash[1];
                    break;
                }
            }
            document.getElementById("access_token").innerHTML = ac;
            setCookie("ac", ac, 'biqing.github.io', '/', 24);
        };

        var init = function(){
            var ac = getCookie("ac");
            if(ac){
                document.getElementById("access_token").innerHTML = ac;
            } else {
                document.getElementById("access_token").innerHTML = "未登录, 或授权已过期";
            }
        };

        init();
    </script>
</body>
</html>